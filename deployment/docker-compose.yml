version: '3'

services:
 nginx:
  container_name: howamidoing-frontend
  image: nginx:1.15-alpine
  volumes:
   - './data/nginx:/etc/nginx/conf.d'
   - '../project:/usr/share/nginx/html'
   - ./data/certbot/conf:/etc/letsencrypt
   - ./data/certbot/www:/var/www/certbot
  command: "/bin/sh -c 'while :; do sleep 6h & wait $${!}; nginx -s reload; done & nginx -g \"daemon off;\"'"
  ports:
   - "4480:80"
   - "4443:443"
 certbot:
  image: certbot/certbot
  volumes:
   - ./data/certbot/conf:/etc/letsencrypt
   - ./data/certbot/www:/var/www/certbot
  entrypoint: "/bin/sh -c 'trap exit TERM; while :; do certbot renew; sleep 12h & wait $${!}; done;'"
